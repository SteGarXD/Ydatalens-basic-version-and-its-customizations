# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–π DataLens - –ó–∞–≤–µ—Ä—à–µ–Ω–æ

**–î–∞—Ç–∞:** 2025-01-24  
**–°—Ç–∞—Ç—É—Å:** –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —à–∞–≥–∏

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–π
- ‚úÖ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å GitHub
- ‚úÖ –ë–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è DataLens –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –≤–µ—Ç–∫—É `master`
- ‚úÖ –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `~/datalens-with-customizations`

### 2. –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è Docker Compose
- ‚úÖ –°–æ–∑–¥–∞–Ω –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `docker-compose.yaml` —Å volumes –¥–ª—è –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–π
- ‚úÖ Volumes –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤:
  - `datalens-ui` (APP_MODE: api)
  - `datalens-ui` (APP_MODE: full)
- ‚úÖ –ü—É—Ç—å –∫ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è–º: `/home/g.stepanov/datalens-with-customizations/customizations/frontend/src/customizations`
- ‚úÖ –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: `/opt/app/src/customizations:ro` (read-only)

### 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–π
```
~/datalens-with-customizations/
‚îú‚îÄ‚îÄ customizations/
‚îÇ   ‚îî‚îÄ‚îÄ frontend/
‚îÇ       ‚îî‚îÄ‚îÄ src/
‚îÇ           ‚îî‚îÄ‚îÄ customizations/
‚îÇ               ‚îú‚îÄ‚îÄ aeronavigator/
‚îÇ               ‚îÇ   ‚îú‚îÄ‚îÄ branding/
‚îÇ               ‚îÇ   ‚îú‚îÄ‚îÄ features/
‚îÇ               ‚îÇ   ‚îú‚îÄ‚îÄ flight-analytics/
‚îÇ               ‚îÇ   ‚îî‚îÄ‚îÄ integrations/
‚îÇ               ‚îú‚îÄ‚îÄ migrations/
‚îÇ               ‚îî‚îÄ‚îÄ index.ts
‚îî‚îÄ‚îÄ INTEGRATION_INSTRUCTIONS.md
```

---

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

### –®–∞–≥ 1: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
cd ~/datalens
docker-compose down
docker-compose up -d
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è volumes

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
docker exec datalens-ui ls -la /opt/app/src/customizations

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∏–¥–Ω—ã —Ñ–∞–π–ª—ã:
# - aeronavigator/
# - migrations/
# - index.ts
```

### –®–∞–≥ 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã, –Ω–æ –∏—Ö –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ:

1. **–ù–∞–π—Ç–∏ –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:
   ```bash
   docker exec datalens-ui find /opt/app -name "index.tsx" -o -name "App.tsx" -o -name "main.tsx"
   ```

2. **–î–æ–±–∞–≤–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–π** (—Ç—Ä–µ–±—É–µ—Ç –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –æ–±—Ä–∞–∑–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞—Ç—á–µ–π):
   ```typescript
   import { loadCustomizations } from './src/customizations';
   loadCustomizations().then(() => {
     // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   });
   ```

### –®–∞–≥ 4: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É
docker exec -it datalens-postgres psql -U postgres -d datalens_us

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
\i /path/to/migrations/001_user_management.sql
\i /path/to/migrations/002_rbac.sql
\i /path/to/migrations/003_versioning.sql
```

–ò–ª–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:

```bash
docker cp ~/datalens-with-customizations/customizations/migrations datalens-postgres:/tmp/
docker exec datalens-postgres psql -U postgres -d datalens_us -f /tmp/migrations/001_user_management.sql
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

1. **–ì–æ—Ç–æ–≤—ã–µ Docker –æ–±—Ä–∞–∑—ã**: DataLens –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–æ—Ç–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã –∏–∑ `ghcr.io/datalens-tech/`, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ frontend/backend.

2. **–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–¥–∞**: –î–ª—è –ø–æ–ª–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–π –Ω—É–∂–Ω–æ:
   - –õ–∏–±–æ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã —Å –∏—Å—Ö–æ–¥–Ω–∏–∫–∞–º–∏ –∏ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è–º–∏
   - –õ–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ç—á–∏ —á–µ—Ä–µ–∑ `patch-package`
   - –õ–∏–±–æ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–∑—ã –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

3. **Volumes**: –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –∫–∞–∫ read-only volumes, –Ω–æ –¥–ª—è –∏—Ö –∑–∞–≥—Ä—É–∑–∫–∏ –Ω—É–∂–Ω–∞ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã

1. **–ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤**:
   - –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ DataLens (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã)
   - –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏
   - –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã —Å –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è–º–∏

2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ç—á–µ–π**:
   - –°–æ–∑–¥–∞—Ç—å –ø–∞—Ç—á–∏ –¥–ª—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫–æ–¥–∞ –≤ –æ–±—Ä–∞–∑–∞—Ö
   - –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø–∞—Ç—á–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

3. **–ö–∞—Å—Ç–æ–º–Ω—ã–µ –æ–±—Ä–∞–∑—ã**:
   - –°–æ–∑–¥–∞—Ç—å Dockerfile –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤
   - –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ –≤ –æ–±—Ä–∞–∑—ã
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –æ–±—Ä–∞–∑—ã –≤ docker-compose

---

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

- ‚úÖ **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞**: 100% –∑–∞–≤–µ—Ä—à–µ–Ω–æ
- ‚úÖ **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker**: 100% –∑–∞–≤–µ—Ä—à–µ–Ω–æ
- ‚è≥ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∫–æ–¥**: –¢—Ä–µ–±—É–µ—Ç –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –æ–±—Ä–∞–∑–æ–≤ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞—Ç—á–µ–π
- ‚è≥ **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π**: –ì–æ—Ç–æ–≤–æ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é
- ‚è≥ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –û–∂–∏–¥–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ –∫–æ–¥

---

## üîß –§–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

- `~/datalens/docker-compose.yaml` - –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å volumes
- `~/datalens/docker-compose.yaml.backup.*` - —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è
- `~/datalens-with-customizations/` - –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è–º–∏
- `~/Ydatalens-basic-version-and-its-customizations/` - —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

---

## üìù –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker ps | grep datalens

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å volumes
docker inspect datalens-ui | grep -A 10 Mounts

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker logs datalens-ui | tail -50

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–π –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker exec datalens-ui ls -la /opt/app/src/customizations
```

---

**–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–π –≤ –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Ç—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∏—Å—Ö–æ–¥–Ω–∏–∫–∞–º –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞—Ç—á–µ–π).

